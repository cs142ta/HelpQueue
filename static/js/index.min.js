var spinner,studentToTaHelpCountTable,questionsTable,averageWaitTimeGraph,dequeuesPerHourGraph,averageTimeWithTAGraph,studentHelpCountGraph,queueActive,currentPassOffHighlightColor,originalTitle,timeout,i=9,postfix="th",ONE_DAY_IN_MILISECONDS=864e5,ONE_HOUR_IN_MILISECONDS=36e5,ONE_MIN_IN_MILISECONDS=6e4,poll=!1,alertShown=!1,enqueueTime=0,currentSpotInLine=-1,activeView="#queue",addressBase="",pauseUpdate=!1,refreshTime=(new Date).getTime(),extendedStatsData=[],globalTas=[],globalStudentNames={},globalStudentNamesRaw=[],flashTitleBool=!1,showNotifBool=!1,currentlyGettingHelp=!1,adjustTimeModalOpen=!1;setInterval(function(){if(poll&&enqueueTime>10){var e=currentlyGettingHelp?"Time Spent With TA: ":"Time Waiting: ",t=getTimeDifference(parseInt(enqueueTime));$("#timeWaitingLabel").html(e),$("#timeWaiting").html(t)}else $("#timeWaiting").html(""),$("#timeWaitingLabel").html("");if($("#refreshText").empty(),!poll){var a=getTimeDifference(parseInt(refreshTime));$("#refreshText").append("<li>Time since this page was last refreshed: "+a+"</li>")}},1e3);var chat=new Chat(!1);$(function(){chat.getState(),$("#sendie").keydown(function(e){if(e.which>=33){var t=$(this).attr("maxlength");this.value.length>=t&&e.preventDefault()}}),$("#sendie").keyup(function(e){if(13==e.keyCode){var t=$(this).val(),a=$(this).attr("maxlength");t.length<=a+1?(chat.send(t,user),$(this).val("")):$(this).val(t.substring(0,a))}}),$("#close-chat").click(function(e){chat.close(user)}),setInterval("chat.update()",1e3)});var helpButtonHandle="/queueUp.php";function getCurrentHelpButtonAction(){return helpButtonHandle}function getTimeDifference(e){var t=new Date(e),a=((new Date).getTime()-t.getTime())/1e3;return parseInt(a/3600)+"h:"+parseInt(a%3600/60)+"m:"+parseInt(a%3600%60)+"s"}function toggleView(e){activeView!=e&&(void 0!==studentToTaHelpCountTable&&($("#studentDataTotalTableFooter").hide(),studentToTaHelpCountTable.clear(),studentToTaHelpCountTable.destroy(),studentToTaHelpCountTable=void 0),void 0!==questionsTable&&(questionsTable.clear(),questionsTable.destroy(),questionsTable=void 0),$(activeView).fadeOut(500,function(){$(e).fadeIn(500),activeView=e}))}function getPollTime(){return pollerTimer}function sortFilterData(e,t,a){e=e.getTime(),t=t.getTime(),currentView=[];for(index in extendedStatsData)if("function"!=typeof extendedStatsData[index]&&(parseInt(extendedStatsData[index].dequeueTime)>=e&&parseInt(extendedStatsData[index].dequeueTime)<=t+ONE_HOUR_IN_MILISECONDS||a)){new Date(parseInt(extendedStatsData[index].enqueueTime)),new Date(parseInt(extendedStatsData[index].dequeueTime));currentView.push(extendedStatsData[index])}return currentView=currentView.sort(function(e,t){return e.enqueueTime-t.enqueueTime}),currentView}function updateExtendedViews(e,t,a){var n=createFilteredGraphs(e,t,a);updateRawData(n.rawDataFilteredByHour,n.daySplitting)}function verifyStudentInputToggleButton(){if($("#getHelpButton").removeClass("btn-danger"),$("#getHelpButton").removeClass("btn-warning"),$("#getHelpButton").removeClass("btn-success"),$(".noQuestionRequiredButtons").removeClass("btn-danger"),$(".noQuestionRequiredButtons").removeClass("btn-warning"),$(".noQuestionRequiredButtons").removeClass("btn-success"),$(".noQuestionRequiredButtons").removeClass("btn-info"),queueActive){var e=$("#questionInput").val(),t=$("#passOffCheckBox").prop("checked");removeSpinner("getHelpButton"),removeSpinner("getHelpButtonNoQuestion"),removeSpinner("passOffButtonNoQuestion"),console.log(e),e.length>0||t?($("#getHelpButton").removeAttr("disabled"),$("#getHelpButton").html("Get in line for help")):($("#getHelpButton").attr("disabled","disabled"),$("#getHelpButton").html("Enter a question")),$("#getHelpButtonNoQuestion").addClass("btn-success"),$("#passOffButtonNoQuestion").addClass("btn-info"),$("#getHelpButtonNoQuestion").html("Get Help"),$("#passOffButtonNoQuestion").html("Pass Off"),$("#questionInput").removeAttr("disabled"),$("#passOffCheckBox").removeAttr("disabled"),$("#getHelpButton").addClass("btn-success"),$("#queueNum").html("You are not currently in line"),$("#questionInputLengthLeft").html(200-e.length+" characters remaining")}else $("#getHelpButton").addClass("btn-warning"),$("#getHelpButton").html("The Help Queue is not currently active"),$("#queueNum").html("Go the TA lab to get help"),$("#getHelpButton").attr("disabled","disabled"),$("#getHelpButtonNoQuestion").attr("disabled","disabled"),$("#passOffButtonNoQuestion").attr("disabled","disabled"),$("#getHelpButtonNoQuestion").addClass("btn-warning"),$("#getHelpButtonNoQuestion").html("The Help Queue is not currently active"),$("#passOffButtonNoQuestion").addClass("btn-warning"),$("#passOffButtonNoQuestion").html("The Help Queue is not currently active"),$("#questionInput").attr("disabled","disabled"),$("#passOffCheckBox").attr("disabled","disabled")}function updateRawData(e,t){$("#rawGraphData").empty(),$("#rawGraphData").append("<table align='center'>"),$("#rawGraphData").append("<tr>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Time</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Student</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Helped By</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Enqueue Time</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Dequeue Time</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Wait Time</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Type</th>"),$("#rawGraphData").append("<th class='graphRawDataTh'>Time Spent With TA</th>"),$("#rawGraphData").append("</tr>");for(hour in e)if(!isNaN(parseInt(hour))){var a=!0;for(value in e[hour])if(!isNaN(parseInt(value))){if($("#rawGraphData").append("<tr>"),a){if(t){var n=(parseInt(hour)+1)*ONE_DAY_IN_MILISECONDS;o=formatOutputDateAMPM(new Date(n),!0,!1)}else{var o,s=parseInt(hour)>=12?"pm":"am";o=0==(o=hour%12)?12:o,o+=s}t?$("#rawGraphData").append("<td style='cursor:pointer;' onclick='onGraphClickMethod(\""+o+"\")'><a>"+o+"</a></td>"):$("#rawGraphData").append("<td>"+o+"</td>"),a=!1}else $("#rawGraphData").append("<td> </td>");$("#rawGraphData").append("<td data-toggle='tooltip' title='"+e[hour][value].netId+"'>"+convertNetIdToName(e[hour][value].netId)+"</td>"),e[hour][value].netId==e[hour][value].removedBy?$("#rawGraphData").append("<td>Themselves</td>"):$("#rawGraphData").append("<td data-toggle='tooltip' title='"+e[hour][value].removedBy+"'>"+convertNetIdToName(e[hour][value].removedBy)+"</td>");var i=new Date(parseInt(e[hour][value].enqueueTime)),l=new Date(parseInt(e[hour][value].dequeueTime));$("#rawGraphData").append("<td>"+formatOutputDateAMPM(i,t,!0)+"</td>"),$("#rawGraphData").append("<td>"+formatOutputDateAMPM(l,t,!0)+"</td>");var d,r=(l.getTime()-i.getTime())/1e3,u=r/60,p=r%60;if($("#rawGraphData").append("<td>"+pad(+u.toFixed(0))+":"+pad(+p.toFixed(2))+"</td>"),$("#rawGraphData").append("<td>"+("true"==e[hour][value].passOff?"Pass Off":"Help")+"</td>"),$("#rawGraphData").append("</tr>"),null==e[hour][value].doneGettingHelp)d="None";else{var c=(parseFloat(e[hour][value].doneGettingHelp)-parseFloat(e[hour][value].dequeueTime))/1e3,m=c%60;d=pad(+(c/60).toFixed(0))+":"+pad(+m.toFixed(2))}$("#rawGraphData").append("<td>"+d+"</td>"),$("#rawGraphData").append("</tr>")}}$("#rawGraphData").append("</table>")}function createFilteredGraphs(e,t,a){var n=$("#averageWaitTimeGraph").get(0).getContext("2d"),o=$("#dequeuesPerHourGraph").get(0).getContext("2d"),s=$("#avgTimeWithTAGraph").get(0).getContext("2d"),i=[],l={},d=t.getTime()+ONE_DAY_IN_MILISECONDS<a.getTime(),r=new Date(t),u=new Date(a),p=r;if($(".graphUnit").empty(),d)for($(".graphUnit").append("Day");u>=p;)i.push(formatOutputDateAMPM(p,!0,!1)),p=new Date(p.getTime()+ONE_DAY_IN_MILISECONDS);else for($(".graphUnit").append("Hour");u>=p;)i.push(p.getHours()),p=new Date(p.getTime()+ONE_HOUR_IN_MILISECONDS);for(var c=0;c<e.length;c++){var m=new Date(parseInt(e[c].dequeueTime)),h=Math.floor((m.getTime()-p.getTimezoneOffset()*ONE_MIN_IN_MILISECONDS)/ONE_DAY_IN_MILISECONDS);$.isArray(l[h])||(l[h]=[]),l[h].push(e[c])}if(d)for(var g=0;g<i.length;g++){var f=i[g].split("/");m=new Date(f[2],f[0]-1,f[1]),h=Math.floor((m.getTime()-m.getTimezoneOffset()*ONE_MIN_IN_MILISECONDS)/ONE_DAY_IN_MILISECONDS);$.isArray(l[h])||(l[h]=[])}var v,T=[],b=[],S=[],D=[],w=[];for(var h in l)if(d)oneDaysHourStats=l,v=$.extend(!0,{},oneDaysHourStats),returnedValues=I(h,oneDaysHourStats,T,b,S,D,w),T=returnedValues.averageWaitTimes,b=returnedValues.medianGraphValues,S=returnedValues.numberHelpCountPerHour,D=returnedValues.numberPassOffCountPerHour,w=returnedValues.avgTimeWithTA;else{oneDaysHourStats=[],oneDaysStats=l[h];for(c=0;c<oneDaysStats.length;c++){var x=new Date(parseInt(oneDaysStats[c].dequeueTime)).getHours();$.isArray(oneDaysHourStats[x])||(oneDaysHourStats[x]=[]),oneDaysHourStats[x].push(oneDaysStats[c])}v=$.extend(!0,{},oneDaysHourStats);for(var y=0;y<i.length;y++)oneDaysHourStats.hasOwnProperty(i[y])||(oneDaysHourStats[i[y]]=[{dequeueTime:0,enqueueTime:0}]);for(y=0;y<i.length;y++)returnedValues=I(i[y],oneDaysHourStats,T,b,S,D,w),T=returnedValues.averageWaitTimes,b=returnedValues.medianGraphValues,S=returnedValues.numberHelpCountPerHour,D=returnedValues.numberPassOffCountPerHour,w=returnedValues.avgTimeWithTA;for(y=0;y<i.length;y++){var N=i[y]>=12?"pm":"am";x=0==(x=i[y]%12)?12:x,i[y]=x+N}}function I(e,t,a,n,o,s,i){for(var l=0,d=0,r=0,u=[],p=0;p<t[e].length;p++){var c=parseInt(t[e][p].dequeueTime)-parseInt(t[e][p].enqueueTime);if(r+=c,u.push(c),null!=t[e][p].doneGettingHelp)l+=parseFloat(t[e][p].doneGettingHelp)-parseFloat(t[e][p].dequeueTime),d++}var m=r/(0==t[e].length?1:t[e].length)/ONE_MIN_IN_MILISECONDS;a.push(+m.toFixed(2));var h=l/(0==d?1:d)/ONE_MIN_IN_MILISECONDS;i.push(+h.toFixed(2));var g=t[e],f=0,v=0;if(1!=g.length||0!=g[0].enqueueTime)for(var T=0;T<g.length;T++)"true"==g[T].passOff?v++:f++;o.push(f),s.push(v);var $=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}(u)/ONE_MIN_IN_MILISECONDS;return isNaN($)&&($=0),n.push(+$.toFixed(2)),{averageWaitTimes:a,numberHelpCountPerHour:o,numberPassOffCountPerHour:s,medianGraphValues:n,avgTimeWithTA:i}}var k={labels:i,datasets:[{label:"Mean",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:T},{label:"Median",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:b}]},C={labels:i,datasets:[{label:"Help Count",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:S},{label:"Pass Off Count",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:D}]},B={labels:i,datasets:[{label:"Average Time With TA",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:w}]};return averageWaitTimeGraph=new Chart(n).BarYaxisMinutes(k,{scaleLabel:"          <%=value%>"}),dequeuesPerHourGraph=new Chart(o).Bar(C),averageTimeWithTAGraph=new Chart(s).Bar(B),{rawDataFilteredByHour:v,daySplitting:d}}function onGraphClickMethod(e){$("input[name=graphSpanning]").filter("[value=oneDay]").prop("checked",!0);var t=convertNumDateToName(e),a=new Date(t);$("#extendedStatsStartDate").val(t),$("#extendedStatsStartTime").val("7:00am"),$("#extendedStatsStartDate").val(t),$("#extendedStatsEndTime").val("9:00pm"),$("#extendedStatsStartDate").datepicker("setDate",a),$("#extendedStatsStartDate").datepicker("setDate",a),waitTimeRadioChanged(),extendedStatsGraphsButton({data:{crunchNumbers:!0}})}function waitTimeRadioChanged(){var e=$("input[name=graphSpanning]:checked").val();"oneDay"==e?($("#extendedStatsEndDate").hide(),$("#graphFromWord").show(),$("#extendedStatsStartTime").show(),$("#extendedStatsEndTime").show()):"multipleDay"==e&&($("#extendedStatsEndDate").show(),$("#graphFromWord").hide(),$("#extendedStatsStartTime").hide(),$("#extendedStatsEndTime").hide(),startTime=$("#extendedStatsStartTime").val("7:00am"),endTime=$("#extendedStatsEndTime").val("9:00pm"))}function extendedStatsGraphsButton(e){var t,a,n,o,s=$("input[name=graphSpanning]:checked").val();if("oneDay"==s)t=$("#extendedStatsStartDate").val(),a=$("#extendedStatsStartTime").val(),n=$("#extendedStatsStartDate").val(),o=$("#extendedStatsEndTime").val();else{if("multipleDay"!=s)return;t=$("#extendedStatsStartDate").val(),a=$("#extendedStatsStartTime").val("7:00am"),n=$("#extendedStatsStartDate").val(),o=$("#extendedStatsEndTime").val("9:00pm")}if(t.length>0&&""!==t&&a.length>0&&""!==a&&n.length>0&&""!==n&&o.length>0&&""!==o)if(e.data.crunchNumbers)if("oneDay"==s?(t=$("#extendedStatsStartDate").datepicker("getDate"),a=$("#extendedStatsStartTime").timepicker("getTime",new Date(t.getTime())),n=$("#extendedStatsStartDate").datepicker("getDate"),o=$("#extendedStatsEndTime").timepicker("getTime",new Date(n.getTime()))):"multipleDay"==s&&(a=$("#extendedStatsStartTime").val("7:00am"),o=$("#extendedStatsEndTime").val("10:00pm"),t=$("#extendedStatsStartDate").datepicker("getDate"),a=$("#extendedStatsStartTime").timepicker("getTime",new Date(t.getTime())),n=$("#extendedStatsEndDate").datepicker("getDate"),o=$("#extendedStatsEndTime").timepicker("getTime",new Date(n.getTime()))),a.getTime()>o.getTime())$("#startTimeAfterEndError").modal();else{void 0!==averageWaitTimeGraph&&averageWaitTimeGraph.destroy(),void 0!==dequeuesPerHourGraph&&dequeuesPerHourGraph.destroy(),void 0!==averageTimeWithTAGraph&&averageTimeWithTAGraph.destroy(),$("#graphsContent").show();getExtendedStats("?netId=&startTime="+a.getTime()+"&endTime="+o.getTime(),function(e){console.log(e),globalTas=e.tas,globalStudentNamesRaw.length=0;for(index in e.studentNames)globalStudentNames[e.studentNames[index].netId]=e.studentNames[index].name,globalStudentNamesRaw.push(e.studentNames[index]);e.hasOwnProperty("studentData")&&void 0!==e.studentData?updateExtendedViews(e.studentData,a,o):alert("The ajax didnt come back in the correct format")},function(e){console.log("Error getting extended content"+e)})}else $("#updateExtendedStatsViews").prop("disabled",!1),$("#updateExtendedStatsViews").removeClass("btn btn-warning"),$("#updateExtendedStatsViews").addClass("btn btn-success",!0),$("#updateExtendedStatsViews").html("Click to update the information below");else $("#updateExtendedStatsViews").prop("disabled",!0),$("#updateExtendedStatsViews").addClass("btn btn-warning",!0),$("#updateExtendedStatsViews").html("Pick a date range to view")}function countUpExtendedStatsForTables(e,t){t="all"==t?"all":"passOff"==t?"true":"false";for(var a={},n={},o={},s=[{title:"Student"}],i=0;i<globalTas.length;i++)n[globalTas[i].name]=0,o[globalTas[i].netId]=globalTas[i].name,s.push({title:globalTas[i].name});s.push({title:"Themselves"}),s.push({title:"Totals"}),n.Themselves=0;for(var l=0;l<e.length;l++)if(e[l].passOff==t||null==e[l].passOff||"all"==t){if(!a.hasOwnProperty([globalStudentNames[e[l].netId]])){var d={};for(i=0;i<globalTas.length;i++)d[globalTas[i].name]=0;d.Themselves=0,a[globalStudentNames[e[l].netId]]=d}e[l].removedBy==e[l].netId?(a[globalStudentNames[e[l].netId]].Themselves++,n.Themselves++):(a[globalStudentNames[e[l].netId]][o[e[l].removedBy]]++,n[convertNetIdToName(e[l].removedBy)]++)}var r=[];for(name in a){(d=[]).push(name);for(data in a[name])d.push(a[name][data]);d.push(countUpStudentTotal(a[name])),r.push(d)}return{tableFormatedData:r,tableColumns:s}}function printTheTaToStudentTable(e,t){var a=countUpExtendedStatsForTables(e,t),n=a.tableFormatedData,o=a.tableColumns;void 0!==studentToTaHelpCountTable&&($("#studentDataTotalTableFooter").hide(),studentToTaHelpCountTable.clear(),studentToTaHelpCountTable.destroy(),studentToTaHelpCountTable=void 0),$("#studentDataTotalTableFooter").show(),studentToTaHelpCountTable=$("#studentDataTotalTable").DataTable({data:n,columns:o,bInfo:!1,bPaginate:!1,fixedHeader:!0});for(var s=1;s<o.length;s++){var i=studentToTaHelpCountTable.column(s);$(i.footer()).html(i.data().reduce(function(e,t){return e+t},0))}}function formatDataForQuestionsTable(e){var t=[];for(index in e)if(!isNaN(index)){var a=e[index];if("true"!=a.passOff){var n=null==a.doneGettingHelp?"None":parseFloat((a.doneGettingHelp-a.dequeueTime)/ONE_MIN_IN_MILISECONDS).toFixed(2)+" minutes";t.push({name:convertNetIdToName(a.netId),removedBy:convertNetIdToName(a.removedBy),question:a.question,dequeueTime:formatOutputDateAMPM(new Date(parseInt(a.dequeueTime)),!0,!0),timeSpentGettingHelpe:n})}}return t}function updateQuestionsTable(e){void 0!==questionsTable&&(questionsTable.clear(),questionsTable.destroy(),questionsTable=void 0),e=formatDataForQuestionsTable(e),questionsTable=$("#questionsTable").DataTable({data:e,columns:[{data:"name",width:"10%"},{data:"removedBy",width:"10%"},{data:"question",width:"50%"},{data:"dequeueTime",width:"15%"},{data:"timeSpentGettingHelpe",width:"15%"}],bInfo:!1,bPaginate:!1,fixedHeader:!0,order:[[3,"asc"]]})}function extendedStatsTableButton(e){var t=$("#studentTabAllDataCheckbox").prop("checked");$("#extendedStatsDateInputTable .date").prop("disabled",t),$("#extendedStatsDateInputTable .time").prop("disabled",t);var a=$("#extendedStatsStartDateTable").val(),n=$("#extendedStatsStartTimeTable").val(),o=$("#extendedStatsStartDateTable").val(),s=$("#extendedStatsEndTimeTable").val();if(a.length>0&&""!==a&&n.length>0&&""!==n&&o.length>0&&""!==o&&s.length>0&&""!==s||t)if(e.data.crunchNumbers){a=$("#extendedStatsStartDateTable").datepicker("getDate"),n=$("#extendedStatsStartTimeTable").timepicker("getTime",new Date(a.getTime())),o=$("#extendedStatsEndDateTable").datepicker("getDate"),s=$("#extendedStatsEndTimeTable").timepicker("getTime",new Date(o.getTime())),n=null==n?new Date:n,s=null==s?new Date:s;var i=function(e){console.log(e),globalTas=e.tas,globalStudentNamesRaw.length=0;for(index in e.studentNames)globalStudentNames[e.studentNames[index].netId]=e.studentNames[index].name,globalStudentNamesRaw.push(e.studentNames[index]);if(e.hasOwnProperty("studentData")&&void 0!==e.studentData){var t=$("input[name=tableType]:checked").val();printTheTaToStudentTable(e.studentData,t)}else alert("The ajax didnt come back in the correct format")},l=function(e){console.log("Error getting extended content"+e)};getExtendedStats(t?"?netId=&startTime=&endTime=":"?netId=&startTime="+n.getTime()+"&endTime="+s.getTime(),i,l)}else $("#updateExtendedStatsViewsTable").prop("disabled",!1),$("#updateExtendedStatsViewsTable").removeClass("btn btn-warning"),$("#updateExtendedStatsViewsTable").addClass("btn btn-success",!0),$("#updateExtendedStatsViewsTable").html("Click to update the information below");else $("#updateExtendedStatsViewsTable").prop("disabled",!0),$("#updateExtendedStatsViewsTable").addClass("btn btn-warning",!0),$("#updateExtendedStatsViewsTable").html("Pick a date range to view")}function countUpStudentTotal(e){var t=0;for(key in e)t+=e[key];return t}function extendedStatsQuestionsButton(e){var t=$("#questionsTabAllDataCheckbox").prop("checked");$("#extendedStatsDateInputQuestions .date").prop("disabled",t);var a=$("#extendedStatsStartDateQuestionsTab").val(),n=$("#extendedStatsEndDateQuestionsTab").val();if(a.length>0&&""!==a&&n.length>0&&""!==n||t)if(e.data.crunchNumbers){a=$("#extendedStatsStartDateQuestionsTab").datepicker("getDate"),n=$("#extendedStatsEndDateQuestionsTab").datepicker("getDate"),n=new Date(n.getTime()+ONE_DAY_IN_MILISECONDS-100);var o=function(e){console.log(e),globalTas=e.tas,globalStudentNamesRaw.length=0;for(index in e.studentNames)globalStudentNames[e.studentNames[index].netId]=e.studentNames[index].name,globalStudentNamesRaw.push(e.studentNames[index]);e.hasOwnProperty("studentData")&&void 0!==e.studentData?updateQuestionsTable(e.studentData):alert("The ajax didnt come back in the correct format")},s=function(e){console.log("Error getting extended content"+e)};getExtendedStats(t?"?netId=&startTime=&endTime=":"?netId=&startTime="+a.getTime()+"&endTime="+n.getTime(),o,s)}else $("#updateExtendedStatsViewsQuestionsTable").prop("disabled",!1),$("#updateExtendedStatsViewsQuestionsTable").removeClass("btn btn-warning"),$("#updateExtendedStatsViewsQuestionsTable").addClass("btn btn-success",!0),$("#updateExtendedStatsViewsQuestionsTable").html("Click to update the information below");else $("#updateExtendedStatsViewsQuestionsTable").prop("disabled",!0),$("#updateExtendedStatsViewsQuestionsTable").addClass("btn btn-warning",!0),$("#updateExtendedStatsViewsQuestionsTable").html("Pick a date range to view")}function showNotification(){"undefined"!=typeof Notification?Notification.requestPermission(function(e){"granted"===e&&(new Notification("It is almost your turn to get help!",{body:"Go to the TA Lab to get help!",tag:"MyNotify"}).onclick=function(){window.focus()});alert("It is almost your turn to get help!")}):alert("It is almost your turn to get help!")}function showChatNote(){var e="New chat session opened!";"undefined"!=typeof Notification?Notification.requestPermission(function(t){"granted"===t&&(new Notification(e,{body:"A TA has something to tell you!",tag:"MyNotify"}).onclick=function(){window.focus()});alert(e)}):alert(e)}function setUpEditRawData(e){var t=$("#editRawDataStartDate").val(),a=$("#editRawDataStartTime").val(),n=$("#editRawDataEndTime").val();if(t.length>0&&""!==t&&a.length>0&&""!==a&&n.length>0&&""!==n)if(e.data.crunchNumbers)if(t=$("#editRawDataStartDate").datepicker("getDate"),a=$("#editRawDataStartTime").timepicker("getTime",new Date(t.getTime())),n=$("#editRawDataEndTime").timepicker("getTime",new Date(t.getTime())),a.getTime()>n.getTime())alert("The end time is before the start time");else{getExtendedStats("?netId=&startTime="+a.getTime()+"&endTime="+n.getTime(),function(e){console.log(e),$("#editRawDataData").empty(),$("#editRawDataData").append("<div class='row'><div class='col-xs-1'><strong>ID</strong></div><div class='col-xs-1'><strong>Student net id</strong></div><div class='col-xs-1'><strong>Removed By</strong></div><div class='col-xs-2'><strong>Enqueue Time</strong></div><div class='col-xs-2'><strong>Dequeue Time</strong></div><div class='col-xs-1'><strong>Question</strong></div><div class='col-xs-1'><strong>Pass off flag</strong></div><div class='col-xs-2'><strong>Done Getting help time</strong></div><div class='col-xs-1'><strong>Action</strong></div></div>"),$.each(e.studentData,function(e,t){$("#editRawDataData").append("<div class='row' style='padding-bottom:5px;' id='"+t.id+"'><div class='col-xs-1'>"+t.id+"</div><div class='col-xs-1'><input type='text' id='editRawNetId' disabled='true' value='"+t.netId+"'/></div><div class='col-xs-1'><input type='text' id='editRawRemovedBy' disabled='true' value='"+t.removedBy+"'/></div><div class='col-xs-2'><input type='text' id='editRawEnqueueTime' disabled='true' value='"+t.enqueueTime+"'/></div><div class='col-xs-2'><input type='text' id='editRawDequeueTime' disabled='true' value='"+t.dequeueTime+"'/></div><div class='col-xs-1'><input type='text' id='editRawQuestion' disabled='true' value='"+t.question+"'/></div><div class='col-xs-1'><input type='text' id='editRawPassOff' disabled='true' value='"+t.passOff+"'/></div><div class='col-xs-2'><input type='text' id='editRawDoneGettingHelpTime' disabled='true' value='"+(null==t.doneGettingHelp?"None":t.doneGettingHelp)+"'/></div><div class='col-xs-1'><button class='btn btn-warning fa fa-edit' id='"+t.id+"Btn' onclick=editRawData('"+t.id+"')></button></div></div>")})},function(e){console.log("Error getting extended content"+e)})}else $("#editRawDataGetDataBtn").prop("disabled",!1),$("#editRawDataGetDataBtn").removeClass("btn btn-warning"),$("#editRawDataGetDataBtn").addClass("btn btn-success",!0),$("#editRawDataGetDataBtn").html("Click to update the information below");else $("#editRawDataGetDataBtn").prop("disabled",!0),$("#editRawDataGetDataBtn").addClass("btn btn-warning",!0),$("#editRawDataGetDataBtn").html("Pick a date range to view")}function editRawData(e,t){var a=["id","netId","removedBy","enqueueTime","dequeueTime","question","passOff","doneGettingHelpTime"],n=!1;"undefinded"!=typeof t&&"cancel"==t&&(n=!0);var o=$("#"+e).find("input").not("button"),s={id:e};o.each(function(t,n){$(n).is(":disabled")&&n.id!=e?($(n).prop("disabled",!1),inEditMode=!0):($(n).prop("disabled",!0),inEditMode=!1,s[a[t+1]]=$(n).val())}),inEditMode||n||serverUpdateRawData(s),$("#editRawDataData").find("button").each(function(t,a){var n=e+"Btn";inEditMode?a.id==n?($(a).prop("disabled",!1),$(a).removeClass("fa fa-edit btn btn-warning"),$(a).addClass("fa fa-save btn btn-success")):($(a).prop("disabled",!0),$(a).removeClass("fa fa-save btn btn-success"),$(a).addClass("fa fa-edit btn btn-warning")):($(a).prop("disabled",!1),$(a).removeClass("fa fa-save btn btn-success"),$(a).addClass("fa fa-edit btn btn-warning"))})}function closeAutoTimeModal(){adjustTimeModalOpen=!1}function updateUI(e){if(e.hasOwnProperty("settings")&&$.each(e.settings,function(e,t){$.each(t,function(e,t){"lastTime"!==e||adjustTimeModalOpen||$("#"+e).prop("value",t.slice(0,-2)+":"+t.slice(-2)),$("#"+e).html(t),$("#"+e).prop("checked","true"==t),"courseTitle"===e&&(null==t||""==t?$("#courseNameChangeModal").modal({backdrop:"static",keyboard:!1}):($("#courseTitle").empty(),$("#courseTitle").html(t),$("#courseTitleField").empty(),$("#courseTitleField").html(t),originalTitle=t+" Help Queue",document.title=t+" Help Queue")),"motd"===e&&($("#currentMOTD").empty(),$("#currentMOTD").html(t)),"notifyThreshold"===e&&(notifyThresholdNum=t,$("#notifyThresholdPostFix").empty(),$("#notifyThresholdPostFix").html(getNumberPostFix(t))),"queueActive"===e&&(queueActive="true"==t,"false"==t&&($("#questionInput").attr("disabled","disabled"),$("#passOffCheckBox").attr("disabled","disabled"))),"passOffHighlightColor"==e&&($("#currentPassOffHighlightColor").css("color",t),currentPassOffHighlightColor=t),"lastXMin"==e&&($(".lastXMin").empty(),$(".lastXMin").html(t)),"requireQuestion"==e&&("true"==t?($("#questionsRequired").show(),$("#questionsNotRequired").hide()):($("#questionsRequired").hide(),$("#questionsNotRequired").show())),"questionsPerDay"==e&&($(".questionsPerDay").empty(),$("#questionsDaily").empty(),$("#questionsDaily").append(t),$(".questionsPerDay").html(t)),"questionsPerWeek"==e&&($(".questionsPerWeek").empty(),$("#questionsWeekly").empty(),$("#questionsWeekly").append(t),$(".questionsPerWeek").html(t))})}),e.hasOwnProperty("status")&&"loggedOut"===e.status)window.location.href="/?logout=";else if(e.hasOwnProperty("status")&&"error"===e.status)e.hasOwnProperty("message")?(alert("ERROR: "+e.message),helpButtonHandle="/queueUp.php",poll=!0,currentSpotInLine=-1,$("#questionInput").removeAttr("disabled"),$("#passOffCheckBox").removeAttr("disabled"),$("#passOffCheckBox").prop("checked",!1),verifyStudentInputToggleButton()):alert("Error with the error");else if(e.hasOwnProperty("spot")&&e.hasOwnProperty("enqueueTime")){if(0==pauseUpdate){var t=e.spot;if(enqueueTime=null==e.startedGettingHelpTime?e.enqueueTime:e.startedGettingHelpTime,currentlyGettingHelp=null!=e.startedGettingHelpTime,t<=notifyThresholdNum&&parseInt(t)>=0&&null==e.startedGettingHelpTime&&(alertShown||currentSpotInLine==t||flashTitleBool||(flashTitleBool=!0,flashTitle("Its almost your turn to get help!"),showNotification())),parseInt(t)<0)helpButtonHandle="/queueUp.php",poll=!0,currentSpotInLine=-1,$("#questionInput").removeAttr("disabled"),$("#passOffCheckBox").removeAttr("disabled"),$("#passOffButtonNoQuestion").removeAttr("disabled"),$("#getHelpButtonNoQuestion").removeAttr("disabled"),flashTitleBool&&$("#questionInput").val(""),$("#passOffCheckBox").prop("checked",!1),verifyStudentInputToggleButton(),flashTitleBool=!1;else{if($("#getHelpButton").removeClass("btn-success"),$("#passOffButtonNoQuestion").removeClass("btn-warning"),$("#getHelpButtonNoQuestion").removeClass("btn-warning"),$("#getHelpButton").addClass("btn-danger"),$("#passOffButtonNoQuestion").addClass("btn-info"),$("#getHelpButtonNoQuestion").addClass("btn-success"),removeSpinner("passOffButtonNoQuestion"),removeSpinner("getHelpButtonNoQuestion"),"true"==e.passOff?($("#getHelpButtonNoQuestion").attr("disabled","disabled"),$("#passOffButtonNoQuestion").removeAttr("disabled"),$("#passOffButtonNoQuestion").removeClass("btn-info"),$("#getHelpButtonNoQuestion").removeClass("btn-success"),$("#passOffButtonNoQuestion").addClass("btn-danger"),null==e.startedGettingHelpTime?($("#passOffButtonNoQuestion").html("Get out of line"),$("#getHelpButtonNoQuestion").html("You are in line to pass off")):($("#passOffButtonNoQuestion").html("Be done getting help"),$("#getHelpButtonNoQuestion").html("You are currently being helped"))):($("#passOffButtonNoQuestion").attr("disabled","disabled"),$("#getHelpButtonNoQuestion").removeAttr("disabled"),$("#getHelpButtonNoQuestion").removeClass("btn-success"),$("#passOffButtonNoQuestion").removeClass("btn-info"),$("#getHelpButtonNoQuestion").addClass("btn-danger"),null==e.startedGettingHelpTime?($("#passOffButtonNoQuestion").html("You are in line to get help"),$("#getHelpButtonNoQuestion").html("Get out of line")):($("#getHelpButtonNoQuestion").html("Be done getting help"),$("#passOffButtonNoQuestion").html("You are currently being helped"))),null==e.startedGettingHelpTime){var a=getNumberPostFix(t);$("#getHelpButton").html("Get out of line"),$("#queueNum").html("You are currently the <strong>"+t+a+"</strong> in line to get help")}else $("#getHelpButton").html("Done getting help"),$("#queueNum").html("<strong>You are currently being helped</strong>");helpButtonHandle="/removeFromQueue.php",removeSpinner("getHelpButton"),poll=!0,currentSpotInLine=t,$("#questionInput").attr("disabled","disabled"),$("#passOffCheckBox").attr("disabled","disabled"),e.hasOwnProperty("question")&&$("#questionInput").val(e.question),e.hasOwnProperty("passOff")&&$("#passOffCheckBox").prop("checked","true"==e.passOff)}}e.hasOwnProperty("questionStatus")&&($("#questionsRemainingDay").empty(),$("#questionsRemainingWeek").empty(),$("#questionsRemainingDay").append(e.questionStatus.questionsRemainingDay),$("#questionsRemainingWeek").append(e.questionStatus.questionsRemainingWeek))}if(e.hasOwnProperty("list")){if(e.list.length>0){if(!flashTitleBool){if(flashTitleBool=!0,showNotifBool)showNotifBool=!1,new Notification("Someone needs your help!",{body:"New student in the queue to help",tag:"MyNotify"}).onclick=function(){window.focus()};flashTitle("Someone needs your help!")}}else flashTitleBool=!1,showNotifBool=!0;poll=!0,$("#list").empty(),$.each(e.list,function(e,t){null==t.question&&(t.question="NONE");var a,n="'"+t.netId+"','"+t.name.replace(" ","&nbsp;")+"'",o='&nbsp;<button id="chatButton'+t.netId+'" onClick=chatWith('+n+') class="btn btn-default btn-xs fa fa-comment-o"> Chat</button>',s='<div class="col-xs-5">'+t.question+o+"</div>";"true"==t.passOff&&(s='<div class="col-xs-5" style="background-color:'+currentPassOffHighlightColor+'">'+t.question+o+"</div>"),a='<div class="row myRow" id="'+t.netId+'"><div class="col-xs-3">'+t.name+"</div>"+s+'<div class="col-xs-2">'+getTimeDifference(parseInt(t.enqueueTime))+'</div><div class="col-xs-2"><button id="removeButton'+t.netId+"\" onClick=removePerson('"+t.netId+'\') class="btn btn-info btn-lg fa fa-ambulance"> Offer Assistance</button></div></div>',$("#list").append(a)})}e.hasOwnProperty("helped")&&(poll=!0,$("#helped").empty(),$.each(e.helped,function(e,t){null==t.question&&(t.question="NONE");var a,n="'"+t.netId+"','"+t.name.replace(" ","&nbsp;")+"'",o='&nbsp;<button id="chatButton'+t.netId+'" onClick=chatWith('+n+') class="btn btn-default btn-xs fa fa-comment-o"> Chat</button>',s='<div class="col-xs-5">'+t.question+o+"</div>";"true"==t.passOff&&(s='<div class="col-xs-5" style="background-color:'+currentPassOffHighlightColor+'">'+t.question+o+"</div>"),a='<div class="row myRow gettingHelpRow" id="'+t.netId+'"><div class="col-xs-3">'+t.name+"<br/>(Being helped by: "+convertNetIdToName(t.beingHelpedBy)+")</div>"+s+'<div class="col-xs-2">'+getTimeDifference(parseInt(t.startedGettingHelpTime))+'</div><div class="col-xs-2"><button id="removeButton'+t.netId+"\" onClick=dequeuePerson('"+t.netId+'\') class="btn btn-danger btn-lg fa fa-times"> Remove</button></div></div>',$("#helped").append(a)})),e.hasOwnProperty("stats")&&($("#statsList").empty(),$("#taList").empty(),$.each(e.stats.tas,function(e,t){var a='<div class="row myRow" id="'+t.netId+'"><div class="col-xs-2">'+(1==t.active?"TA":"TA (non-active)")+'</div><div class="col-xs-3">'+t.netId+'</div><div class="col-xs-3">'+t.name+'</div><div class="col-xs-2">'+t.helpCounter+'</div><div class="col-xs-2">'+t.passOffCounter+"</div></div>";$("#statsList").append(a);var n='<div class="row myRow" id="'+t.netId+'"><div class="col-xs-3">'+t.netId+'</div><div class="col-xs-3">'+t.name+'</div><div class="col-xs-2">'+t.helpCounter+'</div><div class="col-xs-2">'+t.passOffCounter+'</div><div class="col-xs-2">  <input id="'+t.netId+'ActiveToggle" type="checkbox" onchange="toggleTAActive(\''+t.netId+"',"+t.active+')"'+(1==t.active?"checked":"")+"></input>  <button onclick=\"editTAName('"+t.netId+'\')" class="btn btn-sm btn-warning fa fa-edit" style="margin-left:5px; margin-top:-5px;"></button></div>';$("#taList").append(n)}),$("#statsList").append("<hr>"),$.each(e.stats.students,function(e,t){var a='<div class="row myRow" id="'+t.netId+'"><div class="col-xs-2">Student</div><div class="col-xs-3">'+t.netId+'</div><div class="col-xs-3">'+t.name+'</div><div class="col-xs-2">'+t.helpCounter+'</div><div class="col-xs-2">'+t.passOffCounter+"</div></div>";$("#statsList").append(a)})),e.hasOwnProperty("avgs")&&($("#topCount").empty(),$("#topAvg").empty(),$("#queueLen").empty(),$("#currentlyBeingHelped").empty(),$("#enqueueInLastXMin").empty(),$("#dequeueInLastXMin").empty(),$("#topCount").append(e.avgs.avgLen),$("#queueLen").append(e.avgs.queueLen),e.avgs.avg>10?$("#topAvg").append(getTimeDifference(e.avgs.avg)):$("#topAvg").append("0"),e.avgs.hasOwnProperty("currentlyBeingHelpedCount")&&$("#currentlyBeingHelped").append(e.avgs.currentlyBeingHelpedCount),e.avgs.hasOwnProperty("enqueueInLastXMin")&&$("#enqueueInLastXMin").append(e.avgs.enqueueInLastXMin),e.avgs.hasOwnProperty("dequeueInLastXMin")&&$("#dequeueInLastXMin").append(e.avgs.dequeueInLastXMin))}function editTAName(e){$("#taNameEditModal").modal(),$("#changeTaNameNetId").val(e)}function convertNetIdToName(e){for(person in globalTas)if(globalTas[person].netId==e)return globalTas[person].name;return globalStudentNames[e]}function convertNumDateToName(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][(e=new Date(e)).getMonth()]+"-"+e.getDate()+"-"+e.getFullYear()}function formatOutputDateAMPM(e,t,a){var n=e.getMonth()+1,o=e.getDate(),s=e.getFullYear(),i=e.getHours(),l=e.getMinutes(),d=e.getSeconds(),r=i>=12?"pm":"am";i=(i%=12)||12,l=pad(l),d=pad(d);var u="";return t&&(u+=n+"/"+o+"/"+s+" "),a&&(u+=i+":"+l+":"+d+" "+r),u}function pad(e){return("0"+e).slice(-2)}$(function(){originalTitle=document.title,window.flashTitle=function(e,t){t=parseInt(t),isNaN(t)&&(t=5),cancelFlashTitle(timeout),function t(){document.title=document.title==originalTitle?e:originalTitle,flashTitleBool?timeout=setTimeout(t,1e3):document.title=originalTitle}()},window.cancelFlashTitle=function(){clearTimeout(timeout),document.title=originalTitle},setInterval(function(){poll&&getStatus(user)},pollTimer),setInterval(function(){getStatus(user)},6e5);for(var e=window.location.pathname.split("/"),t=0;t<e.length-1;t++)addressBase+=e[t],t<e.length-2&&(addressBase+="/");getExtendedStatsToStart();var a=$("input:radio[name=tableType]");function n(e){$("#graphs").hide(),$("#tables").hide(),$("#questionsTab").hide(),$("#profileTab").hide(),void 0!==studentToTaHelpCountTable&&($("#studentDataTotalTableFooter").hide(),studentToTaHelpCountTable.clear(),studentToTaHelpCountTable.destroy(),studentToTaHelpCountTable=void 0),void 0!==questionsTable&&(questionsTable.clear(),questionsTable.destroy(),questionsTable=void 0),$(e).show()}!1===a.is(":checked")&&a.filter("[value=help]").prop("checked",!0),$("input[name=graphSpanning]").filter("[value=oneDay]").prop("checked",!0),$("#extendedStatsEndDate").hide(),$("#graphFromWord").show(),$("#extendedStatsStartTime").show(),$("#extendedStatsEndTime").show(),$("input[type=radio][name=graphSpanning]").on("change",waitTimeRadioChanged),$("#extendedStatsDateInput .time").timepicker({showDuration:!0,timeFormat:"g:ia",step:60,scrollDefault:"9:00",maxTime:"11:00pm",showDuration:!0}),$("#extendedStatsDateInput .date").datepicker({format:"MM-d-yyyy",autoclose:!0}),$("#extendedStatsDateInput").datepair(),$("#graphsContent").hide(),$("#extendedStatsDateInput .time").on("changeTime",{crunchNumbers:!1},extendedStatsGraphsButton),$("#extendedStatsDateInput .date").on("changeTime",{crunchNumbers:!1},extendedStatsGraphsButton),$("#extendedStatsStartDate").on("input",{crunchNumbers:!1},extendedStatsGraphsButton),$("#extendedStatsStartTime").on("input",{crunchNumbers:!1},extendedStatsGraphsButton),$("#extendedStatsEndDate").on("input",{crunchNumbers:!1},extendedStatsGraphsButton),$("#extendedStatsEndTime").on("input",{crunchNumbers:!1},extendedStatsGraphsButton),$("#updateExtendedStatsViews").prop("disabled",!0),$("#updateExtendedStatsViews").addClass("btn btn-warning",!0),$("#updateExtendedStatsViews").html("Pick a date range to view"),$("#graphsTab").on("click",function(){n("#graphs")}),$("#tableTab").on("click",function(){n("#tables")}),$("#questionsTabBtn").on("click",function(){n("#questionsTab")}),$("#profileTabBtn").on("click",function(){n("#profileTab")}),$("#averageWaitTimeGraph").click(function(e){var t=averageWaitTimeGraph.getBarsAtEvent(e);if(void 0!==t[0]){var a=t[0].label;-1==a.indexOf("am")&&-1==a.indexOf("pm")&&onGraphClickMethod(a)}}),$("#dequeuesPerHourGraph").click(function(e){var t=dequeuesPerHourGraph.getBarsAtEvent(e);if(void 0!==t[0]){var a=t[0].label;-1==a.indexOf("am")&&-1==a.indexOf("pm")&&onGraphClickMethod(a)}}),$("#updateExtendedStatsViewsTable").on("click",{crunchNumbers:!0},extendedStatsTableButton),$("#extendedStatsDateInputTable .time").timepicker({showDuration:!0,timeFormat:"g:ia",step:60,scrollDefault:"9:00",maxTime:"11:00pm",showDuration:!0}),$("#extendedStatsDateInputTable .date").datepicker({format:"MM-d-yyyy",autoclose:!0}),$("#extendedStatsDateInputTable").datepair(),$("#extendedStatsDateInputTable .time").on("changeTime",{crunchNumbers:!1},extendedStatsTableButton),$("#extendedStatsDateInputTable .date").on("changeDate",{crunchNumbers:!1},extendedStatsTableButton),$("#extendedStatsStartDateTable").on("input",{crunchNumbers:!1},extendedStatsTableButton),$("#extendedStatsStartTimeTable").on("input",{crunchNumbers:!1},extendedStatsTableButton),$("#extendedStatsEndDateTable").on("input",{crunchNumbers:!1},extendedStatsTableButton),$("#extendedStatsEndTimeTable").on("input",{crunchNumbers:!1},extendedStatsTableButton),$("#updateExtendedStatsViewsTable").prop("disabled",!0),$("#updateExtendedStatsViewsTable").addClass("btn btn-warning",!0),$("#updateExtendedStatsViewsTable").html("Pick a date range to view"),$("#studentTabAllDataCheckbox").on("click",{crunchNumbers:!1},extendedStatsTableButton),$("#updateExtendedStatsViewsQuestionsTable").on("click",{crunchNumbers:!0},extendedStatsQuestionsButton),$("#extendedStatsDateInputQuestions .date").datepicker({format:"MM-d-yyyy",autoclose:!0}),$("#extendedStatsDateInputQuestions").datepair(),$("#extendedStatsDateInputQuestions .date").on("changeDate",{crunchNumbers:!1},extendedStatsQuestionsButton),$("#extendedStatsStartDateQuestionsTab").on("input",{crunchNumbers:!1},extendedStatsQuestionsButton),$("#extendedStatsEndDateQuestionsTab").on("input",{crunchNumbers:!1},extendedStatsQuestionsButton),$("#updateExtendedStatsViewsQuestionsTable").prop("disabled",!0),$("#updateExtendedStatsViewsQuestionsTable").addClass("btn btn-warning",!0),$("#updateExtendedStatsViewsQuestionsTable").html("Pick a date range to view"),$("#questionsTabAllDataCheckbox").on("click",{crunchNumbers:!1},extendedStatsQuestionsButton);var o={data:globalStudentNamesRaw,getValue:"name",template:{type:"description",fields:{description:"netId"}},list:{match:{enabled:!0},onKeyEnterEvent:s,onClickEvent:s}};function s(){$("#profileSearchInput").val();var e=$(".easy-autocomplete").find("ul li.selected")[0].textContent;getExtendedStats("?netId="+e.substring(e.indexOf("-")+2)+"&startTime=&endTime=",function(e){console.log(e),globalTas=e.tas,globalStudentNamesRaw.length=0;for(index in e.studentNames)globalStudentNames[e.studentNames[index].netId]=e.studentNames[index].name,globalStudentNamesRaw.push(e.studentNames[index]);e.hasOwnProperty("studentData")&&void 0!==e.studentData?function(e){var t=$("#profileSearchInput").val();if(!(t.length<1)){var a=0,n=0,o=0,s=0,i=0,l=0,d=new Date,r=Math.floor((d.getTime()-d.getTimezoneOffset()*ONE_MIN_IN_MILISECONDS)/ONE_DAY_IN_MILISECONDS),u=d.getDay(),p=new Date(d-u*ONE_DAY_IN_MILISECONDS).getTime(),c={};$("#profileQuestions").empty();var m="<div class='row'><div class='col-xs-6'><strong>Question</strong></div><div class='col-xs-2'><strong>Removed By</strong></div><div class='col-xs-2'><strong>Removed At</strong></div><div class='col-xs-2'><strong>Time spent with TA</strong></div></div>";$("#profileQuestions").append(m);var h="",g=0,f=0;for(index in e)if(globalStudentNames[e[index].netId]==t){h=e[index].netId,e[index].removedBy in c||(c[e[index].removedBy]={passOff:0,help:0});var v=new Date(parseInt(e[index].dequeueTime)),T=Math.floor((v.getTime()-v.getTimezoneOffset()*ONE_MIN_IN_MILISECONDS)/ONE_DAY_IN_MILISECONDS);if("true"==e[index].passOff)n++,r==T&&l++,v.getTime()>p&&s++,c[e[index].removedBy].passOff++;else{var b;if(a++,r==T&&i++,v.getTime()>p&&o++,c[e[index].removedBy].help++,null==e[index].doneGettingHelp)b="None";else{var S=parseFloat((e[index].doneGettingHelp-e[index].dequeueTime)/ONE_MIN_IN_MILISECONDS);b=S.toFixed(2)+" minutes",g+=S,f++}var m="<div class='row'><div class='col-xs-6'>"+e[index].question+"</div><div class='col-xs-2'>"+(e[index].removedBy==e[index].netId?"Themselves":convertNetIdToName(e[index].removedBy))+"</div><div class='col-xs-2'>"+formatOutputDateAMPM(new Date(parseInt(e[index].dequeueTime)),!0,!0)+"</div><div class='col-xs-2'>"+b+"</div></div>";$("#profileQuestions").append(m)}}$("#profileName").empty(),$("#profileNetId").empty(),$("#profileTotalHelpCount").empty(),$("#profileTotalPassOffCount").empty(),$("#profileWeekHelpCount").empty(),$("#profileWeekPassOffCount").empty(),$("#profileTodayHelpCount").empty(),$("#profileTodayPassOffCount").empty(),$("#profileAverageTimeSpentWithTA").empty(),$("#profileName").html(t),$("#profileNetId").html(h),$("#profileTotalHelpCount").html(a),$("#profileTotalPassOffCount").html(n),$("#profileWeekHelpCount").html(o),$("#profileWeekPassOffCount").html(s),$("#profileTodayHelpCount").html(i),$("#profileTodayPassOffCount").html(l),$("#profileAverageTimeSpentWithTA").html(parseFloat(g/(0==f?1:f)).toFixed(2)+" minutes"),$("#profileTAHelpCount").empty();var D="<div class='row'><div class='col-xs-4'><strong>Name</strong></div><div class='col-xs-3'><strong>Help Count</strong></div><div class='col-xs-3'><strong>Pass Off</strong></div></div>";$("#profileTAHelpCount").append(D);for(var w=Object.keys(c).sort(function(e,a){var n=convertNetIdToName(e),o=convertNetIdToName(a);return n==t?1:o==t?-1:c[a].help-c[e].help}),x=0;x<w.length;x++){var y=w[x],N=convertNetIdToName(y),D="<div class='row'><div class='col-xs-4'>"+(N==t?"Themselves":N)+"</div><div class='col-xs-3'>"+c[y].help+"</div><div class='col-xs-3'>"+c[y].passOff+"</div></div>";$("#profileTAHelpCount").append(D)}}}(e.studentData):alert("The ajax didnt come back in the correct format")},function(e){console.log("Error getting extended content"+e)})}function i(e,t,a){poll=!0,pauseUpdate=!0;postData({username:e,question:t,passOff:a},getCurrentHelpButtonAction(),function(e){pauseUpdate=!1,updateUI(e),getNameStatus()},function(e){pauseUpdate=!1,console.log(e),$("#questionInput").removeAttr("disabled"),$("#passOffCheckBox").removeAttr("disabled"),$("#passOffButtonNoQuestion").removeAttr("disabled"),$("#getHelpButtonNoQuestion").removeAttr("disabled"),getStatus(userName,!1),alert("You must have been busy! You waited so long BYU automatically logged you out!")})}$("#profileSearchInput").easyAutocomplete(o),$("#profileSearchInput").on("keypress",function(e){13==e.which&&s()}),$("#profileSearch").on("click",s),$("#editRawDataDateInput .time").timepicker({showDuration:!0,timeFormat:"g:ia",step:60,scrollDefault:"9:00",maxTime:"11:00pm",showDuration:!0}),$("#editRawDataDateInput .date").datepicker({format:"MM-d-yyyy",autoclose:!0}),$("#editRawDataDateInput").datepair(),$("#editRawDataDateInput .time").on("changeTime",{crunchNumbers:!1},setUpEditRawData),$("#editRawDataDateInput .date").on("changeTime",{crunchNumbers:!1},setUpEditRawData),$("#editRawDataStartDate").on("input",{crunchNumbers:!1},setUpEditRawData),$("#editRawDataStartTime").on("input",{crunchNumbers:!1},setUpEditRawData),$("#editRawDataEndTime").on("input",{crunchNumbers:!1},setUpEditRawData),$("#editRawDataGetDataBtn").prop("disabled",!0),$("#editRawDataGetDataBtn").addClass("btn btn-warning",!0),$("#editRawDataGetDataBtn").html("Pick a date range to view"),$("#editRawDataGetDataBtn").on("click",{crunchNumbers:!0},setUpEditRawData),$('[data-toggle="tooltip"]').tooltip(),verifyStudentInputToggleButton(),$("#updateExtendedStatsViews").on("click",{crunchNumbers:!0},extendedStatsGraphsButton),$("#questionInput").on("input",verifyStudentInputToggleButton),$("#passOffCheckBox").on("click",verifyStudentInputToggleButton),$("#getHelpButton").on("click",function(){var e=$("#questionInput").val(),t=$("#passOffCheckBox").is(":checked");e.length<0&&0==t&&!poll?alert("Please enter a question or click pass off"):($("#questionInput").attr("disabled","disabled"),$("#passOffCheckBox").attr("disabled","disabled"),spin("getHelpButton"),i(user,e,t))}),$(".noQuestionRequiredButtons").on("click",function(e){console.log(e.target.id);var t=!1;"passOffButtonNoQuestion"==e.target.id&&(t=!0),spin("passOffButtonNoQuestion"),spin("getHelpButtonNoQuestion"),i(user,"",t)}),$("#easterEggTrigger").on("click",function(){var e='<div><center><object type="text/html" data="'+window.location.origin+addressBase+'/static/t-rex-runner-gh-pages/" width="600px" height="200px" style="overflow:auto;"></object> <br/>This help queue was designed and built by Blaine McGary during the Winter Semester 2016. It was  first used during the Winter 2016 semester in the class CS 240.<br/>This CS 142 version is currently maintained by Gandalf the Grey.</center></div>';$("#sexyRexy").empty(),$("#sexyRexy").append(e)}),$("#addTaBtn").on("click",function(){var e=$("#taInput").val(),t=$("#taInputName").val();if(e.length<=0)alert("Please enter a TA net id to add first");else if(t.length<=0)alert("Please enter the TA's name you are trying to add");else{for(var a=!1,n=0;n<globalTas.length;n++)globalTas[n].netId===e&&(a=!0,alert("That net id is already registered as a TA"));if(!a){spin("addTaBtn");postData({username:e,name:t,action:"addTA"},"/editTAs.php",function(e){removeSpinner("addTaBtn"),updateUI(e)},function(e){console.log(e)}),$("#taInput").val(""),$("#taInputName").val("")}}}),$("#editTaNameSubmit").on("click",function(){var e=$("#changeTaNameNetId").val(),t=$("#editTaNameInput").val();if(t.length<=0)alert("Please enter a name");else if(t.match(/[^A-Za-z ]+/))alert("Only alphabetic characters are allowed");else{$("#taNameEditModal").modal("hide");var a={name:t,netId:e};$("#editTaNameInput").val(""),postData(a,"/editNames.php",function(e){"noname"==e.status?$("#taNameEditModal").modal():updateUI(e)},function(e){})}}),$("#queueActive").on("change",function(){var e={key:"queueActive",value:$("#queueActive").prop("checked")};spin("queueActive"),console.log("QUEUE STATE CHANGED"),postData(e,"/changeSettings.php",function(e){$.each(e,function(e,t){$.each(t,function(e,t){$("#"+e).prop("checked","true"==t),removeSpinner(e)})})},function(e){console.log(e)})}),$("#nameSubmit").on("click",function(){var e=$("#nameInput").val();if(e.length<=0)alert("Please enter a name");else if(e.match(/[^A-Za-z ]+/))alert("Only alphabetic characters are allowed");else{$("#nameChangeModal").modal("hide");var t={name:e};$("#nameInput").val(""),postData(t,"/editNames.php",function(e){"noname"==e.status&&$("#nameChangeModal").modal({backdrop:"static",keyboard:!1})},function(e){})}}),$("#changeCourseTitleButton").on("click",function(){$("#courseNameChangeModal").modal({backdrop:"static",keyboard:!1})}),$("#courseSubmit").on("click",function(){var e=$("#courseNameInput").val();if(e.length<=0)alert("Please enter a name");else{$("#courseNameChangeModal").modal("hide");var t={key:"courseTitle",value:e};$("#courseNameInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#courseNameChangeModal").modal({backdrop:"static",keyboard:!1}):updateUI({settings:e})},function(e){})}}),$("#changeStudentPollTime").on("click",function(){$("#studentChangePollTimeModal").modal()}),$("#studentPollTimeSubmit").on("click",function(){var e=$("#studentPollTimeInput").val();if(e.length<=0)alert("Please enter a value in miliseconds");else if(e.match(/[^0-9 ]+/))alert("Only numeric characters are allowed");else if(e<3e3)alert("Value must be greater than 3000");else{$("#studentChangePollTimeModal").modal("hide");var t={key:"studentPollTime",value:e};$("#studentPollTimeInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#studentChangePollTimeModal").modal():(updateUI({settings:e}),alert("Student page must be refreshed for settings to take effect"))},function(e){})}}),$("#changeTAPollTime").on("click",function(){$("#taChangePollTimeModal").modal()}),$("#taPollTimeSubmit").on("click",function(){var e=$("#taPollTimeInput").val();if(e.length<=0)alert("Please enter a value in miliseconds");else if(e.match(/[^0-9 ]+/))alert("Only numeric characters are allowed");else if(e<3e3)alert("Value must be greater than 3000");else{$("#taChangePollTimeModal").modal("hide");var t={key:"taPollTime",value:e};$("#taPollTimeInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#taChangePollTimeModal").modal():(updateUI({settings:e}),alert("Page must be refreshed for settings to take effect"))},function(e){})}}),$("#changeNotifySpotNumberBtn").on("click",function(){$("#notifyThresholdChangeModal").modal()}),$("#notifyThresholdSubmit").on("click",function(){var e=$("#notifyThresholdInput").val();if(e.length<=0)alert("Please enter a value");else if(e.match(/[^0-9 ]+/))alert("Only numeric characters are allowed");else if(e<1)alert("Value must be greater than 1");else{$("#notifyThresholdChangeModal").modal("hide");var t={key:"notifyThreshold",value:e};$("#notifyThresholdInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#notifyThresholdChangeModal").modal():updateUI({settings:e})},function(e){console.log("ERROR "+e)})}}),$("#changeLastXMinBtn").on("click",function(){$("#changeLastXMinModal").modal()}),$("#changeLastXMinSubmit").on("click",function(){var e=$("#changeLastXMinInput").val();if(e.length<=0)alert("Please enter a value");else if(e.match(/[^0-9 ]+/))alert("Only numeric characters are allowed");else if(e<1)alert("Value must be greater than 1");else{$("#changeLastXMinModal").modal("hide");var t={key:"lastXMin",value:e};$("#changeLastXMinInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#changeLastXMinModal").modal():updateUI({settings:e})},function(e){console.log("ERROR "+e)})}}),$("#changeQuestionsPerDayBtn").on("click",function(){$("#changeQuestionPerDayModal").modal()}),$("#changeQuestionPerDaySubmit").on("click",function(){var e=$("#changeQuestionPerDayInput").val();if(e.length<=0)alert("Please enter a value");else if(e.match(/^-?\d+$/))if(e<-1)alert("Value must be >= -1");else{$("#changeQuestionPerDayModal").modal("hide");var t={key:"questionsPerDay",value:e};$("#changeQuestionPerDayInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#changeQuestionPerDayModal").modal():updateUI({settings:e})},function(e){console.log("ERROR "+e)})}else alert("Only numeric characters are allowed")}),$("#changeQuestionsPerWeekBtn").on("click",function(){$("#changeQuestionPerWeekModal").modal()}),$("#changeQuestionPerWeekSubmit").on("click",function(){var e=$("#changeQuestionPerWeekInput").val();if(e.length<=0)alert("Please enter a value");else if(e.match(/^-?\d+$/))if(e<-1)alert("Value must be >= -1");else{$("#changeQuestionPerWeekModal").modal("hide");var t={key:"questionsPerWeek",value:e};$("#changeQuestionPerDayInput").val(""),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#changeQuestionPerWeekModal").modal():updateUI({settings:e})},function(e){console.log("ERROR "+e)})}else alert("Only numeric characters are allowed")}),$("#changeAutoTimeBtn").on("click",function(){adjustTimeModalOpen=!0,$("#changeAutoTimesModal").modal()}),$("#changeAutoTimeSubmit").on("click",function(){var e=$("#lastTime").val();$("#changeAutoTimesModal").modal("hide"),adjustTimeModalOpen=!1;var t={key:"lastTime",value:e.replace(":","")};$("#lastTime").val(e),postData(t,"/changeSettings.php",function(e){"noname"==e.status?$("#changeAutoTimesModal").modal():updateUI({settings:e})},function(e){console.log("ERROR "+e)})}),$("#changeMOTDBtn").on("click",function(){$("#motdChangeModal").modal({backdrop:"static",keyboard:!1})}),$("#motdSubmit").on("click",function(){var e=$("#motdInput").val(),t=$("#motdLinkInput").val();if(e.length<=0)alert("Please enter a MOTD");else{$("#motdChangeModal").modal("hide");var a={motd:e,motdLink:t};$("#motdInput").val(""),postData(a,"/changeSettings.php",function(e){"noname"==e.status?$("#motdChangeModal").modal({backdrop:"static",keyboard:!1}):updateUI({settings:e})},function(e){})}}),$("#changePassOffHighlighColorBtn").on("click",function(){$("#changePassOffHighlighColorModal").modal(),$(".passOffSelector").on("click",function(){var e=this.id.split("_")[1];if(void 0!==e){$("#changePassOffHighlighColorModal").modal("hide");postData({key:"passOffHighlightColor",value:e},"/changeSettings.php",function(e){updateUI({settings:e})},function(e){})}})}),$("#requireQuestion").on("click",function(){var e={key:"requireQuestion",value:$("#requireQuestion").prop("checked")};spin("requireQuestion"),postData(e,"/changeSettings.php",function(e){$.each(e,function(e,t){$.each(t,function(e,t){$("#"+e).prop("checked","true"==t),removeSpinner(e)})})},function(e){console.log(e)})}),$("#autoDisable").on("click",function(){var e={key:"autoDisable",value:$("#autoDisable").prop("checked")};spin("requireQuestion"),postData(e,"/changeSettings.php",function(e){$.each(e,function(e,t){$.each(t,function(e,t){$("#"+e).prop("checked","true"==t),removeSpinner(e)})})},function(e){console.log(e)})}),$("#clearButton").on("click",function(){if(confirm("This will remove everone off the queue, and not count them as being helped. Are you sure you want to do this?")){spin("clearButton");postData(null,"/clearQueue.php",function(e){removeSpinner("clearButton"),"success"==e.status?updateUI(e):(console.log("Error clearing queue"),console.log(e))},function(e){removeSpinner("clearButton"),alert("Error clearing queue")})}}),$("#resetDBBtn").on("click",function(){if(confirm("Are you sure you want to reset the database? This will delete everything! This can not be un-done!")){postData({confirmed:!0},"/DBInit.php",function(e){alert("Database was reset."),getStatus(user)},function(){console.log("error reseting the DB")})}}),$("#stats").hide(),$("#editTAs").hide(),$("#viewSettings").hide(),$("#extendedStats").hide(),$("#editRawData").hide(),$("#viewQueue").on("click",function(){toggleView("#queue")}),$("#viewStats").on("click",function(){toggleView("#stats")}),$("#viewAddTa").on("click",function(){toggleView("#editTAs")}),$("#settings").on("click",function(){toggleView("#viewSettings")}),$("#extendedStatsButton").on("click",function(){toggleView("#extendedStats")}),$("#editRawDataButton").on("click",function(){toggleView("#editRawData")}),"undefined"!=typeof user&&(getStatus(user),getNameStatus());var l=window.alert;window.alert=function(){alertShown=!0,l.apply(window,arguments),alertShown=!1}});var tempSpot=5;function removePerson(e){var t={username:e};spin("removeButton"+e);postData(t,"/removeFromQueue.php",function(t){removeSpinner("removeButton"+e),updateUI(t)},function(e){console.log(e)})}function dequeuePerson(e){var t={username:e};spin("removeButton"+e);postData(t,"/finishHelping.php",function(t){removeSpinner("removeButton"+e),updateUI(t)},function(e){console.log(e)})}function toggleTAActive(e,t){var a;if($("#"+e+"ActiveToggle").prop("checked",1==t),e!==user)if(spin(e+"ActiveToggle"),a=1==t?"Are you sure you want to deactive the TA "+e+"?":"Are you sure you want to active the TA "+e+"?",confirm(a)){var n={username:e,action:"toggleTAActive"};spin("rmvBtn"+e);postData(n,"/editTAs.php",function(t){removeSpinner(e+"ActiveToggle"),updateUI(t)},function(t){removeSpinner(e+"ActiveToggle"),console.log(t)})}else removeSpinner(e+"ActiveToggle");else alert("You can not deactivate yourself!")}function getNumberPostFix(e){var t="th";switch(e%10){case 1:11!=e&&(t="st");break;case 2:12!=e&&(t="nd");break;case 3:13!=e&&(t="rd");break;default:t="th"}return t}function spin(e){$("#"+e).attr("disabled","disabled");e=document.getElementById(e);spinner=(new Spinner).spin(e)}function removeSpinner(e){$("#"+e).removeAttr("disabled"),void 0!==spinner&&spinner.stop()}function serverUpdateRawData(e){$.ajax({url:addressBase+"/updateRawData.php",type:"post",dataType:"json",data:{data:e},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function getNameStatus(){$.ajax({url:addressBase+"/editNames.php",type:"get",dataType:"json",success:function(e){e.hasOwnProperty("name")&&null==e.name&&$("#nameChangeModal").modal({backdrop:"static",keyboard:!1}),console.log(e)},error:function(e){console.log(e)}})}function getStatus(e,t){$.ajax({url:addressBase+"/getStatus.php?id="+e,type:"get",dataType:"json",success:function(e){refreshTime=(new Date).getTime(),updateUI(e)},error:function(a){console.log(a),(t=void 0===t||t)&&getStatus(e,!1)}})}function getExtendedStatsToStart(){getExtendedStats("?netId=&startTime=0&endTime=1",function(e){console.log(e),extendedStatsData=e.studentData,globalTas=e.tas;for(index in e.studentNames)globalStudentNames[e.studentNames[index].netId]=e.studentNames[index].name,globalStudentNamesRaw.push(e.studentNames[index])},function(e){console.log(e)})}function getExtendedStats(e,t,a){$.ajax({url:addressBase+"/getExtendedStats.php"+e,type:"get",dataType:"json",success:t,error:a})}function postData(e,t){postData(e,t,function(e){console.log("Post complete"),console.log(e),updateUI(e)},function(e){console.log(e)})}function postData(e,t,a,n){$.ajax({url:window.location.origin+addressBase+t,type:"post",dataType:"json",success:a,error:n,data:e})}function chatWith(e,t){console.log("Opened chat"),(chat=new Chat(e)).notify(user),chat.enter(user),$("#chat-title").html("Chat with: "+t),$("#chatModal").modal({backdrop:"static",keyboard:!1})}function stuChat(){showChatNote(),($("#chatModal").data("bs.modal")||{}).isShown||(chat.clear(),chat.enter(user),$("#chatModal").modal({backdrop:"static",keyboard:!1}))}Chart.types.Bar.extend({name:"BarYaxisMinutes",draw:function(){Chart.types.Bar.prototype.draw.apply(this,arguments);var e=this.chart.ctx;e.save(),e.textAlign="center",e.textBaseline="bottom",e.fillStyle=this.options.scaleFontColor;var t=.4*this.scale.xScalePaddingLeft,a=this.chart.height/2;e.translate(t,a),e.rotate(-1.570796327),e.fillText("Minutes",0,0),e.restore()}});
